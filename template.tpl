___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Omni Activation Meta Conversion API",
  "categories": ["ANALYTICS", "ADVERTISING", "CONVERSIONS"],
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/jpeg;base64,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\u003d"
  },
  "description": "Advanced server-side Meta Conversion API with identity resolution and enrichment, clear flow, data validation, and monitoring via Snowplow.",
  "containerContexts": [
    "SERVER"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "GROUP",
    "name": "Configuration",
    "displayName": "Configuration",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "TEXT",
        "name": "metaPixelID",
        "displayName": "Meta Pixel ID",
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "help": "To use the Conversions API, you need a Pixel ID. If you\u0027ve already got a Pixel for your website, just use the same Pixel ID for both browser and server events."
      },
      {
        "type": "TEXT",
        "name": "metaApiToken",
        "displayName": "Meta API Token",
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "help": "Generate the Meta API token in Business Manager"
      },
      {
        "type": "SELECT",
        "name": "tagExecutionEnv",
        "displayName": "Tag execution environment",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "prod",
            "displayValue": "Production"
          },
          {
            "value": "qa",
            "displayValue": "QA"
          },
          {
            "value": "staging",
            "displayValue": "Staging"
          },
          {
            "value": "test",
            "displayValue": "Test"
          },
          {
            "value": "dev",
            "displayValue": "Development"
          },
          {
            "value": "local",
            "displayValue": "Local"
          }
        ],
        "simpleValueType": true,
        "help": "Select the environment to feed the Meta conversion API with environment-specific data, ensuring in particular that non-production data is not being fed to the production Meta event manager. Environment key value is also appended to the logging keys used for Omni Monitoring and Omni Identity. If this tag consumes the events generated by the data pipelines generated by Omni Analytics, then it\u0027s recommended for you to associated each version of this tag with a separate Source.",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "CHECKBOX",
        "name": "thisIsTestEvent",
        "checkboxText": "Run as test event",
        "simpleValueType": true,
        "help": "This code helps you check if Facebook receives your server events correctly. Use it to test your server events in Events Manager\u0027s Test Events feature. Look at the Test Events Tool for an example."
      },
      {
        "type": "TEXT",
        "name": "testEventCode",
        "displayName": "Test event code",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "thisIsTestEvent",
            "paramValue": true,
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "CHECKBOX",
        "name": "limitedDataUse",
        "checkboxText": "Enable limited data use (LDU)",
        "simpleValueType": true,
        "help": "Limited Data Use is a choice Meta offers for controlling how your data is used. It\u0027s for businesses in the US and helps meet privacy rules in different states."
      },
      {
        "type": "CHECKBOX",
        "name": "isOmniMonitoringEnabled",
        "checkboxText": "Enable tag monitoring with Omni Monitoring",
        "simpleValueType": true,
        "help": "Omni Monitoring is a part of the Omni CDI that helps you oversee the execution of your server-side tags in real-time. Unsuccessful tag executions will be logged according to the unified Omni Monitoring schema. If enabled along with Omni Identity, the tag will also report the unified Omni ID associated with the tag execution, so that you can see which users failed to be activated downstream. Explore further at omnicdi.datomni.com.",
        "defaultValue": false
      },
      {
        "type": "CHECKBOX",
        "name": "isOmniIdentityResolutionEnabled",
        "checkboxText": "Enable customer event enrichment and logging with Omni Identity",
        "simpleValueType": true,
        "help": "Omni Identity is a module of Omni CDI that offers identity resolution, enrichment, and event logging abilities. It enhances customer matching rates in Meta systems by adding additional customer identifiers to payloads in real-time, eliminating the need for Reverse ETL or a data warehouse.\n\nEnabling this option enhances tags with additional fields, such as sourcing the email associated with the unified identity. The customer variables returned as a result of the identity resolution transaction can be customized. However, it\u0027s crucial to properly configure the required configuration variables for Omni Identity to avoid tag execution failures. If you\u0027re unsure, it\u0027s best not to select this option.\n\nFor further exploration, visit omnicdi.datomni.com.",
        "defaultValue": false
      },
      {
        "type": "GROUP",
        "name": "LDUConfiguration",
        "displayName": "LDU Configuration",
        "groupStyle": "ZIPPY_CLOSED",
        "subParams": [
          {
            "type": "TEXT",
            "name": "countryCodeField",
            "displayName": "LDU country code",
            "simpleValueType": true,
            "enablingConditions": [
              {
                "paramName": "limitedDataUse",
                "paramValue": true,
                "type": "EQUALS"
              }
            ],
            "help": "Country code for the purpose of limited data use. If no value is provided, Meta will resolve country geolocation."
          },
          {
            "type": "TEXT",
            "name": "stateCodeField",
            "displayName": "LDU state code",
            "simpleValueType": true,
            "enablingConditions": [
              {
                "paramName": "limitedDataUse",
                "paramValue": true,
                "type": "EQUALS"
              }
            ],
            "help": "State field for the purpose of turning on the limited data use. If no value is provided, Meta will resolve state geolocation."
          }
        ],
        "enablingConditions": [
          {
            "paramName": "limitedDataUse",
            "paramValue": true,
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "GROUP",
        "name": "Omni Monitoring",
        "displayName": "Omni Monitoring config",
        "groupStyle": "ZIPPY_CLOSED",
        "subParams": [
          {
            "type": "TEXT",
            "name": "omniMonitoringEndpoint",
            "displayName": "Omni Monitoring endpoint",
            "simpleValueType": true,
            "help": "Provide your Omni Monitoring endpoint here. Since Omni CDI and its individual components, like Omni Monitoring, are designed for deployment within on-premise remote cloud infrastructure, each user of Omni CDI will have a different endpoint within their own local cloud environment. It\u0027s recommended to enter environment-specific value."
          },
          {
            "type": "TEXT",
            "name": "omniMonitoringSchemaUri",
            "displayName": "omniMonitoringSchemaUri",
            "simpleValueType": true,
            "help": "Schema against which the monitoring messages are validated, a combination of the tag event name and a custom access token generated by your Omni Collector instance. You receive it from us when you implement Omni CDI."
          }
        ],
        "enablingConditions": [
          {
            "paramName": "isOmniMonitoringEnabled",
            "paramValue": true,
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "GROUP",
        "name": "Omni Identity",
        "displayName": "Omni Identity config",
        "groupStyle": "ZIPPY_CLOSED",
        "subParams": [
          {
            "type": "TEXT",
            "name": "omniIdentityEndpoint",
            "displayName": "Omni Identity endpoint",
            "simpleValueType": true,
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "help": "Provide your Omni Identity endpoint here. Since Omni CDI and its individual components, like Omni Identity, are designed for deployment within on-premise remote cloud infrastructure, each user of Omni CDI will have a different endpoint within their own local cloud environment."
          },
          {
            "type": "TEXT",
            "name": "omniIdentityAccessToken",
            "displayName": "Omni Identity access token",
            "simpleValueType": true,
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "help": "Paste here the Omni Identity access token copied from your instance."
          },
          {
            "type": "TEXT",
            "name": "anonUserIdentifierForIR",
            "displayName": "Anonymous user identifier for identity resolution",
            "simpleValueType": true,
            "help": "Identifier used for the purpose of identity resolution performed by Omni Identity to enrich payloads generated by the tag with additional data points. Should either reference the variable that carries an anonymous identifier or the Unified Omni ID. Using a known, unique identifier (even if anonymous) is recommended. If left blank, the Omni Identity resolution key will be derived from the available customer data points found in the payload, such as external_id or client_id."
          },
          {
            "type": "TEXT",
            "name": "omniIdentityLoggingKey",
            "displayName": "Descriptor for logging identity transactions from this tag in Omni Identity",
            "simpleValueType": true,
            "help": "User identity executions will be logged in their Omni Identity view, accompanied by a decorator specified here. If no decorator is provided, identity transactions will be logged using a human-readable description combining the tag name, event name, and production environment, such as \"omni-meta-capi-addpaymentinfo-production\"."
          }
        ],
        "enablingConditions": [
          {
            "paramName": "isOmniIdentityResolutionEnabled",
            "paramValue": true,
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "CHECKBOX",
        "name": "enableDatomniAsPartnerAgent",
        "checkboxText": "Enable setting Datomni as Partner Agency for tag execution",
        "simpleValueType": true,
        "defaultValue": true,
        "help": "If deselected, the tag will stop reporting Datomni as a partner agent in the tag execution"
      },
      {
        "type": "CHECKBOX",
        "name": "isOmniErrorMonitoringEnabled",
        "checkboxText": "Collect anonymous error data",
        "simpleValueType": true,
        "help": "If deselected, the tag will stop collecting anonymous tag usage data",
        "defaultValue": false
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "Event properties",
    "displayName": "Event properties",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "GROUP",
        "name": "Standard properties",
        "displayName": "Default properties",
        "groupStyle": "ZIPPY_OPEN",
        "subParams": [
          {
            "type": "SELECT",
            "name": "eventName",
            "displayName": "Event name",
            "macrosInSelect": false,
            "selectItems": [
              {
                "value": "AddPaymentInfo",
                "displayValue": "AddPaymentInfo"
              },
              {
                "value": "AddToCart",
                "displayValue": "AddToCart"
              },
              {
                "value": "AddToWishlist",
                "displayValue": "AddToWishlist"
              },
              {
                "value": "CompleteRegistration",
                "displayValue": "CompleteRegistration"
              },
              {
                "value": "Contact",
                "displayValue": "Contact"
              },
              {
                "value": "CustomizeProduct",
                "displayValue": "CustomizeProduct"
              },
              {
                "value": "Donate",
                "displayValue": "Donate"
              },
              {
                "value": "FindLocation",
                "displayValue": "FindLocation"
              },
              {
                "value": "InitiateCheckout",
                "displayValue": "InitiateCheckout"
              },
              {
                "value": "Lead",
                "displayValue": "Lead"
              },
              {
                "value": "Purchase",
                "displayValue": "Purchase"
              },
              {
                "value": "Schedule",
                "displayValue": "Schedule"
              },
              {
                "value": "Search",
                "displayValue": "Search"
              },
              {
                "value": "StartTrial",
                "displayValue": "StartTrial"
              },
              {
                "value": "SubmitApplication",
                "displayValue": "SubmitApplication"
              },
              {
                "value": "Subscribe",
                "displayValue": "Subscribe"
              },
              {
                "value": "ViewContent",
                "displayValue": "ViewContent"
              },
              {
                "value": "Custom Event",
                "displayValue": "Custom Event"
              },
              {
                "value": "PageView",
                "displayValue": "PageView"
              }
            ],
            "simpleValueType": true,
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "help": "Event name to be reported to Facebook. It is recommended to use standard event names. The property is used for deduplicating events sent by both the browser and server when used in conjunction with the \"Event ID\" property. Corresponds to the \"event_name\" property in Omni CDI when used with default data mappers. Explore more at: omnicdi.datomni.com."
          },
          {
            "type": "TEXT",
            "name": "customEventName",
            "displayName": "Custom event name",
            "simpleValueType": true,
            "enablingConditions": [
              {
                "paramName": "eventName",
                "paramValue": "Custom Event",
                "type": "EQUALS"
              }
            ],
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "help": "Use a custom event name only if none of the standard event names accurately describe your event. Corresponds to the \"event_name\" property in Omni CDI when used with default data mappers. Explore more at: omnicdi.datomni.com."
          },
          {
            "type": "TEXT",
            "name": "eventTimestamp",
            "displayName": "Event timestamp",
            "simpleValueType": true,
            "valueValidators": [
              {
                "type": "NUMBER"
              }
            ],
            "help": "Unix timestamp of the event occurrence, required in integer form. Leave blank if unavailable. Corresponds to the \"event_timestamp\" property in Omni CDI when used with default data mappers. Explore more at: omnicdi.datomni.com."
          },
          {
            "type": "SELECT",
            "name": "actionSource",
            "displayName": "Action source",
            "macrosInSelect": false,
            "selectItems": [
              {
                "value": "email",
                "displayValue": "Email"
              },
              {
                "value": "website",
                "displayValue": "Website"
              },
              {
                "value": "app",
                "displayValue": "Mobile application"
              },
              {
                "value": "phone_call",
                "displayValue": "Phone call"
              },
              {
                "value": "chat",
                "displayValue": "Chat"
              },
              {
                "value": "physical_store",
                "displayValue": "Physical store"
              },
              {
                "value": "system_generated",
                "displayValue": "System generated"
              },
              {
                "value": "business_messaging",
                "displayValue": "Business messaging"
              },
              {
                "value": "other",
                "displayValue": "Other"
              }
            ],
            "simpleValueType": true,
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "defaultValue": "website",
            "help": "Indicates the location of the conversion. All action sources provide ad measurement and custom audience creation abilities. Except for \u0027physical store\u0027, all action sources also allow ad optimization."
          }
        ]
      },
      {
        "type": "GROUP",
        "name": "Additional properties",
        "displayName": "Enrichment properties",
        "groupStyle": "ZIPPY_OPEN",
        "subParams": [
          {
            "type": "GROUP",
            "name": "Generic properties",
            "displayName": "Consent \u0026 identification properties",
            "groupStyle": "ZIPPY_OPEN",
            "subParams": [
              {
                "type": "TEXT",
                "name": "optOut",
                "displayName": "Opt-out flag",
                "simpleValueType": true,
                "help": "Boolean value indicating if the user opted out from tracking. If true, ad optimization turns off, and only ad attribution occurs. Corresponds to the \"is_consent_active\" property in Omni CDI when used with default data mappers and Omni Identity with consent enrichment. Explore more at: omnicdi.datomni.com."
              },
              {
                "type": "TEXT",
                "name": "eventId",
                "displayName": "Event ID",
                "simpleValueType": true,
                "help": "This property enables the deduplication of events sent from both the browser and server sides, in conjunction with the \"Event name\" property. It can be any unique string that has also been used with the \u0027eventID\u0027 property on the client side. For it to affect ad optimization and matching during deduplication, it is crucial that both server and client events use the same ID when sent simultaneously."
              }
            ]
          },
          {
            "type": "GROUP",
            "name": "Action source properties",
            "displayName": "Action source properties",
            "groupStyle": "ZIPPY_OPEN",
            "subParams": [
              {
                "type": "GROUP",
                "name": "Website-specific properties",
                "displayName": "Website-specific properties",
                "groupStyle": "ZIPPY_OPEN",
                "subParams": [
                  {
                    "type": "TEXT",
                    "name": "eventSourceUrl",
                    "displayName": "Event source URL",
                    "simpleValueType": true,
                    "enablingConditions": [
                      {
                        "paramName": "actionSource",
                        "paramValue": "website",
                        "type": "EQUALS"
                      }
                    ],
                    "valueValidators": [
                      {
                        "type": "REGEX",
                        "args": [
                          "^(http|https):\\/\\/[^\\s]+$"
                        ]
                      },
                      {
                        "type": "NON_EMPTY"
                      }
                    ],
                    "help": "Specifies the browser\u0027s URL location of the event. This URL should start with either \"http://\" or \"https://\", which is verified by the tag\u0027s built-in regexp. It must match a domain that has been verified. Corresponds to the \"touchpoint_page_url\" property in Omni CDI when used with default data mappers. Explore more at: omnicdi.datomni.com."
                  },
                  {
                    "type": "TEXT",
                    "name": "clientUserAgent",
                    "displayName": "Client user agent",
                    "simpleValueType": true,
                    "valueValidators": [
                      {
                        "type": "NON_EMPTY"
                      }
                    ],
                    "enablingConditions": [
                      {
                        "paramName": "actionSource",
                        "paramValue": "website",
                        "type": "EQUALS"
                      }
                    ],
                    "help": "The user agent for the browser corresponding to the event. Corresponds to the \"device_useragent\" property in Omni CDI when used with default data mappers. Explore more at: omnicdi.datomni.com."
                  }
                ],
                "enablingConditions": [
                  {
                    "paramName": "actionSource",
                    "paramValue": "website",
                    "type": "EQUALS"
                  }
                ]
              }
            ]
          },
          {
            "type": "GROUP",
            "name": "Event-specific properties",
            "displayName": "Event-specific properties",
            "groupStyle": "ZIPPY_OPEN",
            "subParams": [
              {
                "type": "GROUP",
                "name": "Engagement, Nurturing \u0026 Research event properties",
                "displayName": "Engagement, Nurturing \u0026 Research event properties",
                "groupStyle": "ZIPPY_OPEN",
                "subParams": [
                  {
                    "type": "TEXT",
                    "name": "contentName",
                    "displayName": "Content name",
                    "simpleValueType": true,
                    "enablingConditions": [],
                    "help": "Name of the page or product tied to the event. If representing the name of the product, then typically used in the context of monetization events. Matches the \"content_name\" property in Omni CDI when used with default data mappers. Explore further at: omnicdi.datomni.com."
                  },
                  {
                    "type": "TEXT",
                    "name": "searchString",
                    "displayName": "Search query",
                    "simpleValueType": true,
                    "enablingConditions": [
                      {
                        "paramName": "eventNameDropdown",
                        "paramValue": "Search",
                        "type": "EQUALS"
                      },
                      {
                        "paramName": "eventNameDropdown",
                        "paramValue": "Custom Event",
                        "type": "EQUALS"
                      }
                    ],
                    "help": "Search query made by the user. This property matches the \"touchpoint_page_search_query\" property in Omni CDI when used with default data mappers. Explore more at: omnicdi.datomni.com."
                  },
                  {
                    "type": "TEXT",
                    "name": "contentCategory",
                    "displayName": "Content category",
                    "simpleValueType": true,
                    "enablingConditions": [],
                    "help": "The content category related to the event, either page or the piece of content or product, e.g. \"Grocery\", \"Cars\", \"E-book\". Matches the \"content_category\" property in Omni CDI when used with default data mappers. Explore more at: omnicdi.datomni.com."
                  }
                ],
                "help": "These properties are especially recommended for events such as Search, ViewContent, and FindLocation, but they can also enhance Conversion and Monetization events."
              },
              {
                "type": "GROUP",
                "name": "Conversion \u0026 Monetization event properties",
                "displayName": "Conversion \u0026 Monetization event properties",
                "groupStyle": "ZIPPY_OPEN",
                "subParams": [
                  {
                    "type": "TEXT",
                    "name": "orderId",
                    "displayName": "Order ID",
                    "simpleValueType": true,
                    "help": "Order ID for the transaction and checkout. This corresponds to the \u0027order_id\u0027 property in Omni CDI when used with default data mappers. It is retained throughout the checkout and purchase process. Explore more at: omnicdi.datomni.com.",
                    "enablingConditions": [
                      {
                        "paramName": "eventName",
                        "paramValue": "AddToCart",
                        "type": "EQUALS"
                      },
                      {
                        "paramName": "eventName",
                        "paramValue": "Purchase",
                        "type": "EQUALS"
                      },
                      {
                        "paramName": "eventName",
                        "paramValue": "InitiateCheckout",
                        "type": "EQUALS"
                      },
                      {
                        "paramName": "eventName",
                        "paramValue": "Custom event",
                        "type": "EQUALS"
                      }
                    ]
                  },
                  {
                    "type": "TEXT",
                    "name": "value",
                    "displayName": "Value",
                    "simpleValueType": true,
                    "valueValidators": [
                      {
                        "type": "NON_EMPTY",
                        "enablingConditions": [
                          {
                            "paramName": "eventName",
                            "paramValue": "Purchase",
                            "type": "EQUALS"
                          }
                        ],
                        "errorMessage": "The value field is required for Purchase events."
                      }
                    ],
                    "help": "Monetary value (for purchase or checkout events) or value in a some other metric. Corresponds to the \"order_value\" property in the Omni CDI unified schema when used with default data mappers. Explore further at: omnicdi.datomni.com."
                  },
                  {
                    "type": "TEXT",
                    "name": "currency",
                    "displayName": "Currency of value",
                    "simpleValueType": true,
                    "enablingConditions": [
                      {
                        "paramName": "value",
                        "paramValue": "",
                        "type": "PRESENT"
                      }
                    ],
                    "valueValidators": [
                      {
                        "type": "NON_EMPTY"
                      }
                    ]
                  },
                  {
                    "type": "SELECT",
                    "name": "deliveryCategory",
                    "displayName": "Order delivery category",
                    "macrosInSelect": false,
                    "selectItems": [
                      {
                        "value": "in_store",
                        "displayValue": "in_store"
                      },
                      {
                        "value": "curbside",
                        "displayValue": "curbside"
                      },
                      {
                        "value": "home_delivery",
                        "displayValue": "home_delivery"
                      }
                    ],
                    "simpleValueType": true,
                    "help": "Type of delivery for a purchase event. Supported values are: \u0027in_store\u0027 — Customer needs to enter the store to get the purchased product. \u0027curbside\u0027 — Customer picks up their order by driving to a store and waiting inside their vehicle. \u0027home_delivery\u0027 — Purchase is delivered to the customer\u0027s home. This property matches the \u0027order_delivery_method\u0027 property in Omni CDI when used with default data mappers. Explore more at: omnicdi.datomni.com.",
                    "enablingConditions": [
                      {
                        "paramName": "eventName",
                        "paramValue": "Purchase",
                        "type": "EQUALS"
                      }
                    ]
                  },
                  {
                    "type": "TEXT",
                    "name": "status",
                    "displayName": "Status of conversion process",
                    "simpleValueType": true,
                    "help": "Property represents the status of the purchase or signup process."
                  },
                  {
                    "type": "CHECKBOX",
                    "name": "addProductArray",
                    "checkboxText": "Append product data to event",
                    "simpleValueType": true
                  },
                  {
                    "type": "GROUP",
                    "name": "Item cart data",
                    "displayName": "Product (item) cart data",
                    "groupStyle": "ZIPPY_CLOSED",
                    "subParams": [
                      {
                        "type": "SELECT",
                        "name": "contentType",
                        "displayName": "Item (product) type",
                        "selectItems": [
                          {
                            "value": "product",
                            "displayValue": "product"
                          },
                          {
                            "value": "product_group",
                            "displayValue": "product_group"
                          }
                        ],
                        "simpleValueType": true,
                        "help": "Set this property to either \"product\" or \"product_group\" based on the type of items you are sending. If the items in your product schema represent individual products, use \u0027product\u0027. If, instead, the items represent product groups (items that share similarities but have variations such as color, material, size, or pattern), use \"product_group\". This property maps to the \"items_type\" property in the Omni CDI schema. Explore further at: omnicdi.datomni.com.",
                        "defaultValue": ""
                      },
                      {
                        "type": "SELECT",
                        "name": "productSchemaType",
                        "displayName": "Product (item) schema type",
                        "macrosInSelect": false,
                        "selectItems": [
                          {
                            "value": "omniProductSchema",
                            "displayValue": "Omni CDI standarized product schema"
                          },
                          {
                            "value": "customProductSchema",
                            "displayValue": "Custom product schema"
                          }
                        ],
                        "simpleValueType": true,
                        "help": "Determines the type of product schema used in your data payload: either the standardized Omni CDI data schema or a custom product schema."
                      },
                      {
                        "type": "GROUP",
                        "name": "Custom product schema creation",
                        "displayName": "Product (item) schema definition",
                        "groupStyle": "ZIPPY_CLOSED",
                        "subParams": [
                          {
                            "type": "SELECT",
                            "name": "productArrayVariableName",
                            "displayName": "Product (item) array variable name",
                            "macrosInSelect": false,
                            "selectItems": [
                              {
                                "value": "items",
                                "displayValue": "\"items\" (used by GA4)"
                              },
                              {
                                "value": "products",
                                "displayValue": "\"products\" (used by Segment)"
                              },
                              {
                                "value": "other",
                                "displayValue": "other"
                              }
                            ],
                            "simpleValueType": true,
                            "enablingConditions": []
                          },
                          {
                            "type": "TEXT",
                            "name": "productArrayVariableNameCustom",
                            "displayName": "Custom product (item) array variable name",
                            "simpleValueType": true,
                            "enablingConditions": [
                              {
                                "paramName": "productArrayVariableName",
                                "paramValue": "other",
                                "type": "EQUALS"
                              }
                            ],
                            "valueValidators": [
                              {
                                "type": "NON_EMPTY"
                              }
                            ],
                            "valueHint": "e.g. products"
                          },
                          {
                            "type": "TEXT",
                            "name": "contentIdVariableName",
                            "displayName": "Variable name for product (item) ID in your custom product (item) array",
                            "simpleValueType": true,
                            "enablingConditions": [
                              {
                                "paramName": "eventNameDropdown",
                                "paramValue": "AddPaymentInfo",
                                "type": "EQUALS"
                              },
                              {
                                "paramName": "eventNameDropdown",
                                "paramValue": "AddToCart",
                                "type": "EQUALS"
                              },
                              {
                                "paramName": "eventNameDropdown",
                                "paramValue": "InitiateCheckout",
                                "type": "EQUALS"
                              },
                              {
                                "paramName": "eventNameDropdown",
                                "paramValue": "Search",
                                "type": "EQUALS"
                              },
                              {
                                "paramName": "eventNameDropdown",
                                "paramValue": "ViewContent",
                                "type": "EQUALS"
                              },
                              {
                                "paramName": "eventNameDropdown",
                                "paramValue": "Custom Event",
                                "type": "EQUALS"
                              },
                              {
                                "paramName": "eventNameDropdown",
                                "paramValue": "AddToWishlist",
                                "type": "EQUALS"
                              },
                              {
                                "paramName": "eventNameDropdown",
                                "paramValue": "Purchase",
                                "type": "EQUALS"
                              },
                              {
                                "paramName": "productArrayVariableName",
                                "paramValue": "other",
                                "type": "EQUALS"
                              }
                            ],
                            "help": "Type the name of the variable that represents the content ID in your product array",
                            "valueHint": "e.g. product_id"
                          },
                          {
                            "type": "TEXT",
                            "name": "contentPriceVariableName",
                            "displayName": "Variable name for product (item) name in your custom product (item) array",
                            "simpleValueType": true,
                            "enablingConditions": [
                              {
                                "paramName": "eventNameDropdown",
                                "paramValue": "AddPaymentInfo",
                                "type": "EQUALS"
                              },
                              {
                                "paramName": "eventNameDropdown",
                                "paramValue": "AddToCart",
                                "type": "EQUALS"
                              },
                              {
                                "paramName": "eventNameDropdown",
                                "paramValue": "InitiateCheckout",
                                "type": "EQUALS"
                              },
                              {
                                "paramName": "eventNameDropdown",
                                "paramValue": "Search",
                                "type": "EQUALS"
                              },
                              {
                                "paramName": "eventNameDropdown",
                                "paramValue": "ViewContent",
                                "type": "EQUALS"
                              },
                              {
                                "paramName": "eventNameDropdown",
                                "paramValue": "Custom Event",
                                "type": "EQUALS"
                              },
                              {
                                "paramName": "eventNameDropdown",
                                "paramValue": "AddToWishlist",
                                "type": "EQUALS"
                              },
                              {
                                "paramName": "eventNameDropdown",
                                "paramValue": "Purchase",
                                "type": "EQUALS"
                              },
                              {
                                "paramName": "productArrayVariableName",
                                "paramValue": "other",
                                "type": "EQUALS"
                              }
                            ],
                            "help": "Type the name of the variable that represents the content price in your product array",
                            "valueHint": "e.g. product_price"
                          },
                          {
                            "type": "TEXT",
                            "name": "contentQuantityVariableName",
                            "displayName": "Variable name for product (item) quantity in your custom product (item) array",
                            "simpleValueType": true,
                            "enablingConditions": [
                              {
                                "paramName": "eventNameDropdown",
                                "paramValue": "AddPaymentInfo",
                                "type": "EQUALS"
                              },
                              {
                                "paramName": "eventNameDropdown",
                                "paramValue": "AddToCart",
                                "type": "EQUALS"
                              },
                              {
                                "paramName": "eventNameDropdown",
                                "paramValue": "InitiateCheckout",
                                "type": "EQUALS"
                              },
                              {
                                "paramName": "eventNameDropdown",
                                "paramValue": "Search",
                                "type": "EQUALS"
                              },
                              {
                                "paramName": "eventNameDropdown",
                                "paramValue": "ViewContent",
                                "type": "EQUALS"
                              },
                              {
                                "paramName": "eventNameDropdown",
                                "paramValue": "Custom Event",
                                "type": "EQUALS"
                              },
                              {
                                "paramName": "eventNameDropdown",
                                "paramValue": "AddToWishlist",
                                "type": "EQUALS"
                              },
                              {
                                "paramName": "eventNameDropdown",
                                "paramValue": "Purchase",
                                "type": "EQUALS"
                              },
                              {
                                "paramName": "productArrayVariableName",
                                "paramValue": "other",
                                "type": "EQUALS"
                              }
                            ],
                            "help": "Type the name of the variable that represents the content quantity in your product array",
                            "valueHint": "e.g. product_quantity"
                          }
                        ],
                        "enablingConditions": [
                          {
                            "paramName": "productSchemaType",
                            "paramValue": "customProductSchema",
                            "type": "EQUALS"
                          }
                        ],
                        "help": "Specifies the variable names for specific fields utilized in your payload\u0027s product (item) schema. Here, you should input the individual variable or data keys, rather than entire variables containing complete data points. The tag will then construct the Meta API-formatted product (item) data object for downstream ingestion."
                      }
                    ],
                    "help": "Identify the product schema presented in your data payload. The tag enables you to customize your product schema by specifying variable names for your product array and individual properties, including product ID, quantity, and price.",
                    "enablingConditions": [
                      {
                        "paramName": "addProductArray",
                        "paramValue": true,
                        "type": "EQUALS"
                      }
                    ]
                  }
                ],
                "help": "These properties are especially recommended for events such as Purchase, CompleteRegistration, InitiateCheckout, and others."
              }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "User properties",
    "displayName": "User properties",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "GROUP",
        "name": "personalDataProps",
        "displayName": "PII properties",
        "groupStyle": "ZIPPY_OPEN",
        "subParams": [
          {
            "type": "TEXT",
            "name": "firstName",
            "displayName": "First name",
            "simpleValueType": true,
            "help": "First name extracted from the user payload. This property corresponds to the \"person_firstname\" property in the Omni CDI unified schema."
          },
          {
            "type": "TEXT",
            "name": "lastName",
            "displayName": "Last name",
            "simpleValueType": true,
            "help": "Last name extracted from the user payload. Matches the \"person_lastname\" property in Omni CDI when used with default data mappers. Explore further at: omnicdi.datomni.com."
          },
          {
            "type": "GROUP",
            "name": "genderConfiguration",
            "displayName": "Gender",
            "groupStyle": "ZIPPY_CLOSED",
            "subParams": [
              {
                "type": "TEXT",
                "name": "maleGenderIdentifier",
                "displayName": "Male gender identifier",
                "simpleValueType": true,
                "help": "Enter the description of the male gender as appears in the systems from which you\u0027re capturing data to activate with this tag. This is used to dynamically identify proper gender of the user and then translate it to the values required by the Meta API.",
                "valueHint": "e.g. male, man, m, on, him, or mężczyzna"
              },
              {
                "type": "TEXT",
                "name": "femGenderIdentifier",
                "displayName": "Female gender identifier",
                "simpleValueType": true,
                "help": "Enter the description of the female gender as appears in the systems from which you\u0027re capturing data to activate with this tag. This is used to dynamically identify proper gender of the user and then translate it to the values required by the Meta API.",
                "valueHint": "e.g. female, woman, f, or ona"
              },
              {
                "type": "TEXT",
                "name": "gender",
                "displayName": "Gender value",
                "simpleValueType": true,
                "help": "Reference the gender variable from the event payload."
              }
            ],
            "help": "The value of the user gender extracted from the user payload. This property corresponds to the \"person_gender\" property in the Omni CDI unified schema when used with default data mappers. Explore further at: omnicdi.datomni.com."
          },
          {
            "type": "GROUP",
            "name": "phoneNumberConfiguration",
            "displayName": "Phone number configuration",
            "groupStyle": "ZIPPY_CLOSED",
            "subParams": [
              {
                "type": "TEXT",
                "name": "fbPhone",
                "displayName": "Phone",
                "simpleValueType": true,
                "help": "Raw phone number captured in the event data. Corresponds to the \"person_phone\" property in the Omni CDI unified schema when used with default data mappers. Explore further at: omnicdi.datomni.com."
              },
              {
                "type": "RADIO",
                "name": "fbPhoneIncludesCountryCode",
                "displayName": "Phone number carries country code",
                "radioItems": [
                  {
                    "value": "yes",
                    "displayValue": "Yes"
                  },
                  {
                    "value": "no",
                    "displayValue": "No"
                  }
                ],
                "simpleValueType": true,
                "help": "Determine whether or not the value of the phone number as it appears in your data payload activated by this tag originally carries the country code."
              },
              {
                "type": "TEXT",
                "name": "phoneCountryCode",
                "displayName": "Country code  - CHEK DESCF",
                "simpleValueType": true,
                "enablingConditions": [
                  {
                    "paramName": "fbPhoneCountryCodeSelector",
                    "paramValue": "no",
                    "type": "EQUALS"
                  }
                ],
                "help": "Determines the value of the country code appearing in the data payload. Corresponds to the \"user_location_country_code\" property in the Omni CDI unified schema when used with default data mappers. Explore further at: omnicdi.datomni.com."
              }
            ]
          },
          {
            "type": "GROUP",
            "name": "birthDateConfiguration",
            "displayName": "Birth date configuration",
            "groupStyle": "ZIPPY_CLOSED",
            "subParams": [
              {
                "type": "SELECT",
                "name": "birthDateFormat",
                "displayName": "Birthday format",
                "macrosInSelect": false,
                "selectItems": [
                  {
                    "value": "yyyymmdds",
                    "displayValue": "YYYY*MM*DD (* denotes any separator), e.g. 1998-03-26"
                  },
                  {
                    "value": "yyyyddmms",
                    "displayValue": "YYYY*DD*MM (* denotes any separator), e.g. e.g. 1998/26/03"
                  },
                  {
                    "value": "yyyymmdd",
                    "displayValue": "YYYYMMDD (no separators), e.g. 19980326"
                  },
                  {
                    "value": "yyyyddmm",
                    "displayValue": "YYYYDDMM (no separators), e.g. 19982603"
                  },
                  {
                    "value": "ddmonyyyys",
                    "displayValue": "DD*Mon*YYYY (* denotes any separator), e.g. 26 March 1998"
                  },
                  {
                    "value": "ddmonyyyy",
                    "displayValue": "DDMonYYYY (no separators), e.g. 26 March 1998"
                  }
                ],
                "simpleValueType": true,
                "help": "Birthday format which is characteristic of your event payload."
              },
              {
                "type": "TEXT",
                "name": "birthDate",
                "displayName": "Birth date",
                "simpleValueType": true,
                "help": "References the variable that carries the birthday value in the payload of the event that\u0027s activated by the tag. Corresponds to the \"person_birthdate\" property in the Omni CDI unified schema when used with default data mappers. Explore further at: omnicdi.datomni.com."
              }
            ]
          },
          {
            "type": "GROUP",
            "name": "emailConfiguration",
            "displayName": "Email configuration",
            "groupStyle": "ZIPPY_CLOSED",
            "subParams": [
              {
                "type": "TEXT",
                "name": "fbEmail",
                "displayName": "Email",
                "simpleValueType": true,
                "help": "Represents user email as found in the payload. | Corresponds to the \"person_email\" key found in the Unified Omni CDI payload."
              },
              {
                "type": "CHECKBOX",
                "name": "enrichPayloadWithOmniIdentityEmail",
                "checkboxText": "Enrich payload with Omni Identity email",
                "simpleValueType": true,
                "help": "This feature operates independently of the standard Email field in the tag. Through identity enrichment, it will add any additional emails linked to the user in Omni Identity from their previous touchpoints, improving user matching downstream.",
                "enablingConditions": [
                  {
                    "paramName": "isOmniIdentityResolutionEnabled",
                    "paramValue": true,
                    "type": "PRESENT"
                  }
                ],
                "defaultValue": false
              }
            ]
          }
        ]
      },
      {
        "type": "GROUP",
        "name": "locationProperties",
        "displayName": "Location properties",
        "groupStyle": "ZIPPY_OPEN",
        "subParams": [
          {
            "type": "TEXT",
            "name": "city",
            "displayName": "City",
            "simpleValueType": true,
            "help": "References the data key that carries the city value in the payload of the event that\u0027s activated by the tag. Corresponds to the \"user_location_city\" property from the unified Omni CDI payload when utilizing standard data mappers."
          },
          {
            "type": "TEXT",
            "name": "state",
            "displayName": "State",
            "simpleValueType": true,
            "help": "References the data key that carries the city value in the payload of the event that\u0027s activated by the tag.  Assumes the 2-character ANSI abbreviation code in lowercase. Corresponds to the \"user_location_region\" property from the unified Omni CDI payload when utilizing standard data mappers."
          },
          {
            "type": "TEXT",
            "name": "zip",
            "displayName": "Zip Code",
            "simpleValueType": true,
            "help": "References the data key that carries the zip code value in the payload of the event that\u0027s activated by the tag. Use lowercase with no spaces and no dash. Use only the first 5 digits for U.S. zip codes. Use the area, district, and sector format for the UK. Corresponds to the \"user_location_zipcode\" property from the unified Omni CDI payload when utilizing standard data mappers."
          },
          {
            "type": "TEXT",
            "name": "country",
            "displayName": "Country",
            "simpleValueType": true,
            "help": "References the data key that carries the country value in the payload of the event that\u0027s activated by the tag. Use the lowercase, 2-letter country codes in ISO 3166-1 alpha-2. Corresponds to the \"user_location_country\" property from the unified Omni CDI payload when utilizing standard data mappers."
          },
          {
            "type": "TEXT",
            "name": "ipAddress",
            "displayName": "IP address",
            "simpleValueType": true,
            "help": "References the data key that carries the IP value in the payload of the event that\u0027s activated by the tag. Corresponds to the \"user_location_ipv6\" property from the unified Omni CDI payload when utilizing standard data mappers.",
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "enablingConditions": [
              {
                "paramName": "actionSource",
                "paramValue": "website",
                "type": "EQUALS"
              }
            ]
          }
        ]
      },
      {
        "type": "GROUP",
        "name": "attributionProperties",
        "displayName": "Attribution properties (_fbp, _fbc)",
        "groupStyle": "ZIPPY_OPEN",
        "subParams": [
          {
            "type": "GROUP",
            "name": "fbpConfiguration",
            "displayName": "_fbp configuration",
            "groupStyle": "ZIPPY_CLOSED",
            "subParams": [
              {
                "type": "TEXT",
                "name": "fbp",
                "displayName": "_fbp",
                "simpleValueType": true,
                "help": "Data key referencing the value of _fbp. Corresponds to the \"attribution_campaign_meta_fbp\" property from the unified Omni CDI payload when utilizing standard data mappers."
              },
              {
                "type": "CHECKBOX",
                "name": "isFbpFromTraces",
                "checkboxText": "Enable enrichment from fbp_traces",
                "simpleValueType": true,
                "enablingConditions": [],
                "help": "Determines if the _fbp value should be retrieved from the fbp traces stores if it is null on the current event (applicable only to Omni CDI)."
              },
              {
                "type": "TEXT",
                "name": "fbpTraces",
                "displayName": "fbp_traces",
                "simpleValueType": true,
                "help": "Corresponds to the \"attribution_campaign_meta_fbp_traces\" property from the unified Omni CDI payload when utilizing standard data mappers.",
                "enablingConditions": [
                  {
                    "paramName": "isFbpFromTraces",
                    "paramValue": true,
                    "type": "EQUALS"
                  }
                ]
              },
              {
                "type": "SELECT",
                "name": "fbpTracePosition",
                "displayName": "fbp_traces index",
                "macrosInSelect": false,
                "selectItems": [
                  {
                    "value": "firstTouchFbp",
                    "displayValue": "First touch _fbp"
                  },
                  {
                    "value": "lastTouchFbp",
                    "displayValue": "Last touch _fbp"
                  },
                  {
                    "value": "randomFbp",
                    "displayValue": "Random _fbp"
                  }
                ],
                "simpleValueType": true,
                "enablingConditions": [
                  {
                    "paramName": "isFbpFromTraces",
                    "paramValue": true,
                    "type": "EQUALS"
                  }
                ],
                "help": "Specifies the _fbp value to which the event should be attributed."
              }
            ]
          },
          {
            "type": "GROUP",
            "name": "fbcConfiguration",
            "displayName": "_fbc configuration",
            "groupStyle": "ZIPPY_CLOSED",
            "subParams": [
              {
                "type": "TEXT",
                "name": "fbc",
                "displayName": "_fbc",
                "simpleValueType": true,
                "help": "Corresponds to the \"attribution_campaign_meta_fbc\" property from the unified Omni CDI payload when utilizing standard data mappers."
              },
              {
                "type": "CHECKBOX",
                "name": "isFbcFromTraces",
                "checkboxText": "Enable enrichment from fbc_traces",
                "simpleValueType": true,
                "enablingConditions": [],
                "help": "Determines if the _fbc value should be retrieved from the fbc traces stores if it is null on the current event (applicable only to Omni CDI)."
              },
              {
                "type": "TEXT",
                "name": "fbcTraces",
                "displayName": "fbc_traces",
                "simpleValueType": true,
                "help": "Corresponds to the \"attribution_campaign_meta_fbc_traces\" property from the unified Omni CDI payload when utilizing standard data mappers.",
                "enablingConditions": [
                  {
                    "paramName": "isFbcFromTraces",
                    "paramValue": true,
                    "type": "EQUALS"
                  }
                ]
              },
              {
                "type": "SELECT",
                "name": "fbcTracePosition",
                "displayName": "fbc_traces index",
                "macrosInSelect": false,
                "selectItems": [
                  {
                    "value": "firstTouchFbc",
                    "displayValue": "First touch fbc"
                  },
                  {
                    "value": "lastTouchFbc",
                    "displayValue": "Last touch fbc"
                  },
                  {
                    "value": "randomFbc",
                    "displayValue": "Random fbc"
                  }
                ],
                "simpleValueType": true,
                "enablingConditions": [
                  {
                    "paramName": "isFbcFromTraces",
                    "paramValue": true,
                    "type": "EQUALS"
                  }
                ],
                "help": "Specifies the _fbp value to which the event should be attributed."
              }
            ]
          }
        ]
      },
      {
        "type": "GROUP",
        "name": "identityProperties",
        "displayName": "Identity properties",
        "groupStyle": "ZIPPY_OPEN",
        "subParams": [
          {
            "type": "TEXT",
            "name": "subscriptionId",
            "displayName": "Subscription ID",
            "simpleValueType": true,
            "help": "When used with Omni CDI, it corresponds to the \"subscription_id\" and \"items[i].id\" combined with \"items_type\" equal \"subscription\", when utilizing standard data mappers."
          },
          {
            "type": "GROUP",
            "name": "externalIdConfiguration",
            "displayName": "External ID configuration",
            "groupStyle": "ZIPPY_CLOSED",
            "subParams": [
              {
                "type": "CHECKBOX",
                "name": "enrichExtIdwithOmniUnifiedId",
                "checkboxText": "Populate Meta Conversion API\u0027s External ID property with Omni Unified ID",
                "simpleValueType": true,
                "help": "When selected, the tag will populate the Meta API\u0027s event payload\u0027s external_id property with the output of the identity resolution transaction for the specific user associated with a given Omni identity key. Turning this hides the \"external_id\" as a separate field for manual configuration in the tag.",
                "enablingConditions": [
                  {
                    "paramName": "isOmniIdentityResolutionEnabled",
                    "paramValue": true,
                    "type": "PRESENT"
                  }
                ],
                "defaultValue": false
              },
              {
                "type": "TEXT",
                "name": "externalId",
                "displayName": "External ID",
                "simpleValueType": true,
                "enablingConditions": [
                  {
                    "paramName": "populateExtIdwithOmniUnifiedId",
                    "paramValue": false,
                    "type": "EQUALS"
                  },
                  {
                    "paramName": "populateExtIdwithOmniUnifiedId",
                    "paramValue": "",
                    "type": "NOT_PRESENT"
                  }
                ]
              },
              {
                "type": "RADIO",
                "name": "externalIdHashing",
                "displayName": "Should the external ID be hashed?",
                "radioItems": [
                  {
                    "value": "Yes",
                    "displayValue": "Yes"
                  },
                  {
                    "value": "No",
                    "displayValue": "No"
                  }
                ],
                "simpleValueType": true,
                "enablingConditions": [
                  {
                    "paramName": "external_id",
                    "paramValue": "",
                    "type": "PRESENT"
                  }
                ]
              }
            ]
          }
        ]
      },
      {
        "type": "GROUP",
        "name": "deviceProperties",
        "displayName": "Device properties",
        "groupStyle": "ZIPPY_OPEN",
        "subParams": [
          {
            "type": "TEXT",
            "name": "userAgent",
            "displayName": "User agent",
            "simpleValueType": true,
            "help": "Device user agent. Corresponds to the device_useragent key found in the Omni CDI payload."
          }
        ]
      }
    ]
  }
]


___SANDBOXED_JS_FOR_SERVER___

const getAllEventData = require('getAllEventData');
const getContainerVersion = require('getContainerVersion');
const getTimestampMillis = require('getTimestampMillis');
const JSON = require('JSON');
const logToConsole = require('logToConsole');
const makeNumber = require('makeNumber');
const makeString = require('makeString');
const Math = require('Math');
const sendHttpRequest = require('sendHttpRequest');
const sha256Sync = require('sha256Sync');
const createRegex = require('createRegex');
const Promise = require('Promise');
const Object = require('Object');
const generateRandom = require('generateRandom');
const makeInteger = require('makeInteger');
const toBase64 = require('toBase64');

// Prepare data according to the environment
let eventData;
if (data.tagExecutionEnv === 'dev' || data.tagExecutionEnv === 'local' || data.tagExecutionEnv === 'test') {
    eventData = {
        event_name: 'vr',
        client_id: '22f',
        'x-ga-mp2-data[client_id]': '13453tfa'
    };
} else {
    eventData = getAllEventData();
}

// Globals

const TAG_VERSION = "omni-a-gtmss-metaconversionapi-1.31";
const TAG_NAME = "Omni Meta Conversion API";

// Logging and monitoring levels
const isOmniErrorMonitoringEnabled = data.isOmniErrorMonitoringEnabled;
const isOmniMonitoringEnabled = data.isOmniMonitoringEnabled; // check the key
const isOmniIdentityResolutionEnabled = data.isOmniIdentityResolutionEnabled;
let omniIdentityObject = {};

const isTagLoggingEnabled = () => {
    const containerVersion = getContainerVersion();
    return containerVersion && 
        (containerVersion.debugMode || 
         (containerVersion.previewMode && containerVersion.previewMode.value)) || 
        false;
};

// Add this near the top of the file after the requires
let currentExecutionTraceId = null;
let tagInitializationTime = null;

// Generate a trace ID that persists throughout the tag execution and is dispatched to the activation monitor

const generateTraceId = (eventDataTemp) => {
    if (currentExecutionTraceId) {
        return currentExecutionTraceId;
    }

    tagInitializationTime = getTimestampMillis();

    if (!eventDataTemp || !eventDataTemp.event_name || !eventDataTemp.client_id) {
        logToConsole('[' + TAG_NAME + ' v' + TAG_VERSION + '] Error: Cannot generate trace ID - missing required fields');
        return null;
    }    
    const adjustedTimestamp = Math.floor(tagInitializationTime / 5000) * 5000;
    
    const traceString = [
        eventDataTemp.event_name,
        eventDataTemp.client_id,
        adjustedTimestamp
    ].join('_');

    currentExecutionTraceId = sha256Sync(traceString, { outputEncoding: 'hex' });

    logToConsole('[' + TAG_NAME + ' v: ' + TAG_VERSION + '] Tag execution initialized', {
        trace_id: currentExecutionTraceId,
        event_name: eventDataTemp.event_name,
        timestamp_bucket: adjustedTimestamp,
        initialization_time: tagInitializationTime,
        message: 'All logs in this tag execution will use this trace ID'
    });

    return currentExecutionTraceId;
};

// Update the omniLog object to use the trace ID
const omniLog = {
    tagName: TAG_NAME,
    containerId: getContainerVersion().containerId,
    tagVersion: TAG_VERSION,
    executionEnv: data.tagExecutionEnv,
    rawEventName: eventData.event_name,
    traceId: generateTraceId(eventData)
};

// Update getLogTimestamp to include trace ID
function getLogTimestamp() {
    return {
        timestamp: getTimestampMillis(),
        traceId: currentExecutionTraceId || generateTraceId(eventData)
    };
}

const buildLogMessage = (type, process, scope, detailLog) => {
    let logEntry = {};
    for (let key in omniLog) {
        if (omniLog.hasOwnProperty(key)) {
            logEntry[key] = omniLog[key];
        }
    }
    const timestampData = getLogTimestamp();
    logEntry.timestamp = makeString(timestampData.timestamp);
    logEntry.traceId = timestampData.traceId;
    logEntry.type = type;
    logEntry.process = process;
    logEntry.scope = scope;
  
    switch (type) {
        case 'Info':
            logEntry.message = detailLog.message;
            break;
        case 'Error':
            logEntry.errorMessage = detailLog.message;
            break;
        case 'Tag error':
            logEntry.errorMessage = detailLog.message;
            break;
        case 'Request':
            logEntry.requestMethod = detailLog.requestMethod;
            logEntry.requestUrl = detailLog.requestUrl;
            logEntry.requestHeader = detailLog.requestHeaders;
            logEntry.requestBody = detailLog.requestBody;
            break;
        case 'Response':
            logEntry.responseStatusCode = detailLog.statusCode;
            logEntry.responseHeaders = detailLog.responseHeaders;
            logEntry.responseBody = detailLog.responseBody;
            break;
        default:
            return {
                type: 'Info',
                process: 'Logging',
                scope: 'Omni Tag',
                message: 'Unknown operation type provided: ' + type,
                timestamp: makeString(getTimestampMillis()),
                traceId: currentExecutionTraceId || generateTraceId(eventData)
            };
    }
    return logEntry; 
};

const digestLog = (type, process, scope, detailLog) => {
    if (isTagLoggingEnabled() || isOmniMonitoringEnabled || isOmniErrorMonitoringEnabled) {
          const logEntry = buildLogMessage(type, process, scope, detailLog);

          if (isTagLoggingEnabled()) {
            logToConsole(JSON.stringify(logEntry));
        }

          if ((type === 'Response' && isOmniMonitoringEnabled) || (type === 'Tag error' && isOmniErrorMonitoringEnabled)) {
            digestToOmniMonitor(logEntry, type);
        }
    }

    return null;
};

function digestToOmniMonitor(logEntry, type) {
    let monitoringSchemaUri, payloadSchemaUri, eventSchemaUri, omniMonitorEndpoint;

    if (type === 'Tag error') {
        monitoringSchemaUri = "iglu:com.datomni/omnicdi_errormonitoring_omnimetaapiconversiontag/jsonschema/1-0-0";
        omniMonitorEndpoint = "https://omni.datomni.com/com.snowplowanalytics.snowplow/tp2";
    } else {
        monitoringSchemaUri = data.omniMonitoringSchemaUri;
        omniMonitorEndpoint = data.omniMonitoringEndpoint;
    }
    
    eventSchemaUri = "iglu:com.snowplowanalytics.snowplow/payload_data/jsonschema/1-0-4";
    payloadSchemaUri = "iglu:com.snowplowanalytics.snowplow/unstruct_event/jsonschema/1-0-0";
     
    const logEntryPayload = {
        schema: payloadSchemaUri,
        data: {
            schema: monitoringSchemaUri,
            data: logEntry
        }
    };
  
    const monitoringBody = {
        e: 'ue',
        ue_px: toBase64(JSON.stringify(logEntryPayload)),
        p: 'srv',
        tv: "1.31",
        dtm: makeString(getTimestampMillis())
    };

    const monitoringEvent = {
        schema: eventSchemaUri,
        data: [monitoringBody]
    };

    const eventPayload = JSON.stringify(monitoringEvent);
    
    return sendHttpRequest(omniMonitorEndpoint, {
        headers: {
            'Content-Type': 'application/json'
        },
        method: 'POST'
    }, eventPayload).then(() => {
        // Direct console log instead of digestLog to avoid recursion
        if (isTagLoggingEnabled()) {
            logToConsole('Tag execution failed. Error monitoring event was processed successfully. We\'ll consider your error - get in touch with us as activation@datomni.com for more questions about the tag issues.');
        }
        return true;
    }).catch(error => {
        // Direct console log instead of digestLog to avoid recursion
        if (isTagLoggingEnabled()) {
            logToConsole('Tag execution failed. Error monitoring event was processed successfully. We\'ll consider your error - get in touch with us as activation@datomni.com for more questions about the tag issues.', error);
        }
        return false;
    });
}

// Property normalization and hashing functions
function normalize(input) {
    if (!input) return null;
    return makeString(input).toLowerCase().trim();  
}

function hash(input) {
    if (!input) return null;
    return sha256Sync(input, { outputEncoding: 'hex' });
}

// Data cleaning utilities
function removeNonDigits(string) {
    const regexPattern = '[^0-9]';
    const digitRegex = createRegex(regexPattern, 'g');
    return string.replace(digitRegex, '');
}
  
function removeLeadingZeros(string) {
    const zeroRegexPattern = '^0+';
    const zeroRegex = createRegex(zeroRegexPattern, 'i');
    return string.replace(zeroRegex, '');
}

function removePunctuation(string) {
    const symbolRegex = createRegex('[[:punct:]]', 'g');
    return string.replace(symbolRegex, '');
}
  
function removeDigits(string) {
    const symbolRegex = createRegex('[0-9]', 'g');
    return string.replace(symbolRegex, '');
}

function removeSpaces(string) {
    const symbolRegex = createRegex('\\s', 'g');
    return string.replace(symbolRegex, '');
}

// Data cleaning for specific fields
function cleanRawPhoneNumber(phone) {
    return removeLeadingZeros(removeNonDigits(phone));
}

function cleanRawString(input) {
    return removePunctuation(removeDigits(input));
}
  
function cleanBirthday(input) {
    return removePunctuation(input);
}

function cleanValue(input) {
    const symbolRegex = createRegex('\\,', 'g');
    return input.replace(symbolRegex, '.');
}

// Field validation functions
function isValidEmail(email) {
    const atSymbolRegex = createRegex('@', '');
    if (email.match(atSymbolRegex)) {
        return true;
    } else {
        return false;
    }
}

function isValidBirthday(format) {
    if (format == "yyyymmdd" || format == "yyyymmdds") {
        return true;
    } else {
        return false;
    }
}

// Event preparation functions
function prepEventName(eventName, customEventName) {
    if (!eventName && !customEventName) return null;
    return eventName === "Custom Event" ? normalize(customEventName) : eventName;
}

function prepEventTime(eventTimestamp) {
    if (!eventTimestamp) eventTimestamp = Math.round(getTimestampMillis() / 1000);

    const timestamp = makeInteger(eventTimestamp);
    const aroundOneYearAgoTimestamp = getTimestampMillis() - (365 * 24 * 60 * 60 * 1000);

    if (timestamp > aroundOneYearAgoTimestamp) {
        return timestamp;
    } else {
        return Math.round(getTimestampMillis() / 1000);
    }
}

// User data preparation functions
function prepEmail(email) {
    if (!email || !isValidEmail(email)) return null;

    const normalized = normalize(removeSpaces(email));
    if (!normalized) return null;
    
    if (isOmniIdentityResolutionEnabled) {
        omniIdentityObject.email = normalized;
    }

    return hash(normalized);
}

function prepPhone(phone, carriesCountryCode, countryCode) {
    if (!phone) return null;

    if (carriesCountryCode === "no" && countryCode) {
        phone = countryCode + phone;
    }

    const cleaned = cleanRawPhoneNumber(phone);
    if (!cleaned) return null;

    const normalized = normalize(cleaned);
    if (!normalized) return null;
    
    if (isOmniIdentityResolutionEnabled) {
        omniIdentityObject.phone = normalized;
    }

    return hash(normalized);
}

function prepName(name) {
    if (!name) return null;
    
    const cleaned = cleanRawString(name);
    const normalized = normalize(cleaned);
    if (!normalized) return null;
    
    digestLog('Info', 'Hashing', 'Omni Tag', {
        message: 'Hashing name input:' + normalized
    });
    
    const hashed = hash(normalized);
    
    digestLog('Info', 'Hashing', 'Omni Tag', {
        message: 'Hashed output:' + hashed
    });
    
    return hashed;
}

function prepBirthday(birthday, format) {
    if (!birthday || !isValidBirthday(format)) return null;
    return hash(cleanBirthday(makeString(birthday)));
}

function prepGender(genderFromData, fKey, mKey) {
    if (!genderFromData || !fKey || !mKey) return null;

    const normalizedInput = normalize(genderFromData);
    const normalizedFKey = normalize(fKey);
    const normalizedMKey = normalize(mKey);

    if (normalizedInput === normalizedFKey) {
        return hash('f');
    } else if (normalizedInput === normalizedMKey) {
        return hash('m');
    }

    return null;
}

function prepCity(city) {
    if (!city) return null;
    const cleaned = cleanRawString(city);
    const normalized = normalize(removeSpaces(cleaned));
    return normalized ? hash(normalized) : null;
}

function prepState(state) {
    if (!state) return null;
    const normalized = normalize(removeSpaces(cleanRawString(state)));
    return normalized ? hash(normalized) : null;
}

function prepZipcode(zip) {
    if (!zip) return null;
    const normalized = normalize(removeSpaces(removePunctuation(zip)));
    return normalized ? hash(normalized) : null;
}

function prepCountry(countryCode) {
    if (!countryCode) return null;
    const normalized = normalize(countryCode);
    return normalized ? hash(normalized) : null;
}

function prepExtId(extid, externalIdHashing) {
    if (!extid) return null; 
    
    if (isOmniIdentityResolutionEnabled) {
        omniIdentityObject.anonymous_id = extid;
    }

    if (externalIdHashing === "Yes") {
        return hash(extid);
    }
    return extid;
}

function prepClientIp(ip) {
    if (!ip) return null;
    return removeSpaces(ip);
}

function prepOrderId(orderId) {
    if (!orderId) return null;
    return orderId.trim();
}

function prepUserAgent(userAgent) {
    if (!userAgent) return null;
    return userAgent.trim();
}

// _fbc / _fbp handling

function extractFbFromTrace(fbTraces, fbxTracePosition) {
    let tracesCount = fbTraces.length;
    if (fbxTracePosition === "firstTouchFbp" || fbxTracePosition === "firstTouchFbc") {
        return fbTraces[0];
    } else if (fbxTracePosition === "lastTouchFbp" || fbxTracePosition === "lastTouchFbc") {
        return fbTraces[tracesCount - 1];
    } else if (fbxTracePosition === "randomFbp" || fbxTracePosition === "randomFbc") {
        let randomIndex = Math.floor(generateRandom(0, tracesCount - 1));
        return fbTraces[randomIndex];
    }
}

function getProcessedFbx(fbx, isFbxFromTraces, fbxTraces, fbxTracePosition) {
    if (fbx) {
        return fbx;
    } else {
        if (isFbxFromTraces) {
            return extractFbFromTrace(fbxTraces, fbxTracePosition);
        } 
        return null;
    }
}

function prepFbp(fbp) {
    const processedFbp = getProcessedFbx(fbp, data.isFbpFromTraces, data.fbpTraces, data.fbpTracePosition);
    return processedFbp;
}

function prepFbc(fbc) {
    const processedFbc = getProcessedFbx(fbc, data.isFbcFromTraces, data.fbcTraces, data.fbcTracePosition);
    return processedFbc;
}

function prepSubscriptionId(subscriptionId) {
    if (!subscriptionId) return null; 
    return subscriptionId;  
}
  
function prepDeliveryCategory(deliveryCategory) {
    if (!deliveryCategory) return null;
    return normalize(deliveryCategory);
}

function prepContentType(contentType) {
    if (!contentType) return null;
    return normalize(removePunctuation(contentType));
}

function prepContentCategory(category) {
    if (!category) return null;
    return normalize(removePunctuation(category));
}

function prepValue(value) {
    if (!value) return null;  // Return null if the input is undefined, null, or an empty string

    let convertedValue = makeNumber(removeSpaces(cleanValue(value)));
    if (convertedValue === 0 || convertedValue === null) {
        // Treat 0 as an unsuccessful conversion and also handle null returned from makeNumber
        return null;
    }

    return convertedValue;
}

function prepCurrency(currency) {
    if (!currency) return null;
    
    const currencyCodes = [
        "AED", "AFN", "ALL", "AMD", "ANG", "AOA", "ARS", "AUD", "AWG", "AZN", "BAM", "BBD", "BDT", "BGN", "BHD", "BIF", "BMD", "BND", "BOB", "BOV",
        "BRL", "BSD", "BTN", "BWP", "BYN", "BZD", "CAD", "CDF", "CHE", "CHF", "CHW", "CLF", "CLP", "CNY", "COP", "COU", "CRC", "CUP", "CVE", "CZK",
        "DJF", "DKK", "DOP", "DZD", "EGP", "ERN", "ETB", "EUR", "FJD", "FKP", "GBP", "GEL", "GHS", "GIP", "GMD", "GNF", "GTQ", "GYD", "HKD", "HNL",
        "HTG", "HUF", "IDR", "ILS", "INR", "IQD", "IRR", "ISK", "JMD", "JOD", "JPY", "KES", "KGS", "KHR", "KMF", "KPW", "KRW", "KWD", "KYD", "KZT",
        "LAK", "LBP", "LKR", "LRD", "LSL", "LYD", "MAD", "MDL", "MGA", "MKD", "MMK", "MNT", "MOP", "MRU", "MUR", "MVR", "MWK", "MXN", "MXV", "MYR",
        "MZN", "NAD", "NGN", "NIO", "NOK", "NPR", "NZD", "OMR", "PAB", "PEN", "PGK", "PHP", "PKR", "PLN", "PYG", "QAR", "RON", "RSD", "RUB", "RWF",
        "SAR", "SBD", "SCR", "SDG", "SEK", "SGD", "SHP", "SLE", "SLL", "SOS", "SRD", "SSP", "STN", "SVC", "SYP", "SZL", "THB", "TJS", "TMT", "TND",
        "TOP", "TRY", "TTD", "TWD", "TZS", "UAH", "UGX", "USD", "USN", "UYI", "UYU", "UYW", "UZS", "VED", "VES", "VND", "VUV", "WST", "XAF", "XAG",
        "XAU", "XBA", "XBB", "XBC", "XBD", "XCD", "XDR", "XOF", "XPD", "XPF", "XPT", "XSU", "XTS", "XUA", "XXX", "YER", "ZAR", "ZMW", "ZWL"
    ];

    // Use makeString for type safety, trim for whitespace, and toUpperCase for standardization
    const normalizedCurrency = makeString(currency).trim().toUpperCase();
    
    if (currencyCodes.indexOf(normalizedCurrency) !== -1) {
        return normalizedCurrency;
    }
    return null;
}

function prepSearchTerm(searchString) {
    if (!searchString) return null;
    return normalize(removePunctuation(searchString));  
}

function prepStatus(status) {
    if (!status) return null;
    return normalize(removePunctuation(status));
}

function prepContentName(content_name) {
    if (!content_name) return null;
     return normalize(removePunctuation(content_name));
}

function prepProductArray(productSchemaType, productArrayVariableName, contentIdVariableName, contentQuantityVariableName, contentPriceVariableName, deliveryCategory) {
    let productArray = [];
    let contentIds = [];
    let contents = [];  // This will store objects only if content_quantity is available
    if (productSchemaType === "omniProductSchema") {
      productArray = eventData['x-ga-mp2-data[items]'];
      contentIdVariableName = "id";
      contentQuantityVariableName = "quantity";
      contentPriceVariableName = "price";
    } else if (productSchemaType === "customProductSchema") {
      if (productArrayVariableName === "other") {
        productArray = eventData['x-ga-mp2-data[' + data.productArrayVariableNameCustom + ']'];
      } else {
        productArray = eventData['x-ga-mp2-data[' + productArrayVariableName + ']'];
      }
    for (let i = 0; i < productArray.length; i++) {
    digestLog('Info', 'Payload building', 'Omni Tag', 'Product array length: ' + productArray.length);

      // log('productArray.length', productArray.length);
      const product = productArray[i];
      const contentId = product[contentIdVariableName];
      if (contentId) {
        contentIds.push(contentId);  
        const contentQuant = makeInteger(product[contentQuantityVariableName]);
        if (contentQuant && contentQuant !== 0) {
          const contentObject = { id: contentId, quantity: contentQuant };
          if (deliveryCategory) {
            contentObject.delivery_category = deliveryCategory;
          }
          if (product[contentPriceVariableName]) {
            contentObject.item_price = product[contentPriceVariableName];
          }
          contents.push(contentObject);
        }
  
      }
    }

  if (contents.length > 0) {
      return { contents: contents }; 
  } else {
      return { contentIds: contentIds }; 
  }
}
}

function prepEventSource(eventSourceUrl) {
    if (!eventSourceUrl) return null;  // Handle null, undefined, or empty string gracefully
  let cleanedSourceURL = normalize(eventSourceUrl);
  return cleanedSourceURL;
}

function prepOptOut(isConsentActive) {
    if (isConsentActive === "0") {
        return true;
    } else {
        return false;
    }
}

function prepActionSource(actionSource) {
    return normalize(actionSource); 
}

function prepEventId(eventId) {
    let cleanedEventId = normalize(eventId);
    return cleanedEventId;
}

function assemblePayloadComponent(dataMappings, payload) {
    payload = {};
    Object.keys(dataMappings).forEach(key => {
        const value = dataMappings[key]();  // Execute the deferred function from the mappings
        if (value != null) {  // Only include keys where the value is not null
            payload[key] = value;
        }
    });
    return payload;
}

const userDataMappings = {
    'em': () => prepEmail(data.fbEmail),
    'ph': () => prepPhone(data.fbPhone, data.fbPhoneIncludesCountryCode, data.phoneCountryCode),
    'fn': () => prepName(data.firstName),
    'ln': () => prepName(data.lastName),
    'db': () => prepBirthday(data.birthDate, data.birthDateFormat),
    'ge': () => prepGender(data.gender, data.femGenderIdentifier, data.maleGenderIdentifier),
    'ct': () => prepCity(data.city),
    'st': () => prepState(data.state),
    'zp': () => prepZipcode(data.zip),
    'country': () => prepCountry(data.country),
    'client_ip_address': () => prepClientIp(data.ipAddress),
    'client_user_agent': () => prepUserAgent(data.clientUserAgent),
    'fbc': () => prepFbc(data.fbc),
    'fbp': () => prepFbp(data.fbp),
    'subscription_id': () => prepSubscriptionId(data.subscriptionId),
    'external_id': () => prepExtId(data.externalId, data.externalIdHashing) 
};

const customDataMappings = (function() {
    const ecommerceData = buildEcommerceData(data);
    const contents = ecommerceData && ecommerceData.contents ? ecommerceData.contents : null;
    const contentIds = ecommerceData && ecommerceData.content_ids ? ecommerceData.content_ids : null;
    const numItems = contents ? contents.length : contentIds ? contentIds.length : null;

    return {
        'currency': () => prepCurrency(data.currency),
        'value': () => prepValue(data.value),
        'search_string': () => prepSearchTerm(data.searchString),
        'status': () => prepStatus(data.status),
        'content_name': () => prepContentName(data.contentName),
        'content_type': () => prepContentType(data.contentType),
        'content_category': () => prepContentCategory(data.contentCategory),
        'delivery_category': () => prepDeliveryCategory(data.deliveryCategory),
        'order_id': () => prepOrderId(data.orderId),
        'contents': () => contents,
        'content_ids': () => contentIds,
        'num_items': () => numItems
    };
})();

const lduDataMappings = (function() {
    const lduData = buildLDUdata(data);
    return {
        'data_processing_options': () => lduData.data_processing_options ? lduData.data_processing_options : null,
        'data_processing_options_country': () => lduData.data_processing_options_country ? lduData.data_processing_options_country : null,
        'data_processing_options_state': () => lduData.data_processing_options_state ? lduData.data_processing_options_state : null
    };
})();

const basicDataMappings = {
    'event_name': () => prepEventName(data.eventName, data.customEventName),
    'event_time': () => prepEventTime(data.eventTimestamp),
    'action_source': () => prepActionSource(data.actionSource),
    'opt_out': () => prepOptOut(data.optOut),
    'event_id': () => prepEventId(data.eventId),
    'event_source_url': () => prepEventSource(data.eventSourceUrl),
};

function buildEcommerceData(data) { 
    const ecommerceData = prepProductArray(
        data.productSchemaType, 
        data.productArrayVariableName, 
        data.contentIdVariableName, 
        data.contentQuantityVariableName, 
        data.contentPriceVariableName, 
        data.deliveryCategory
    );
    if (ecommerceData && ecommerceData.contents) {
        return {
            contents: ecommerceData.contents,
            num_items: ecommerceData.contents.length
        };
    } else if (ecommerceData && ecommerceData.contentIds) {
        return {
            content_ids: ecommerceData.contentIds,
            num_items: ecommerceData.contentIds.length
        };
    }
    return ecommerceData;
}

function buildLDUdata(data) {
    // Initialize the options object with default values
    const lduData = {
        data_processing_options: [],
        data_processing_options_country: null,
        data_processing_options_state: null
    };

    if (data.limitedDataUse) {
        lduData.data_processing_options = ["LDU"];
        lduData.data_processing_options_country = (data.countryCodeField === "US") ? 1 : 0;

        // Check specific state codes for special values
        if (data.stateCodeField) {
            if (data.stateCodeField === "CA") {
                lduData.data_processing_options_state = 1000;
            } else if (data.stateCodeField === "CO") {
                lduData.data_processing_options_state = 1001;
            } else {
                lduData.data_processing_options_state = data.stateCodeField;
            }
        } else {
            lduData.data_processing_options_state = 0;
        }
    }
    
    return lduData;
}

function isEmpty(obj) {
    return Object.keys(obj).length === 0 && obj.constructor === Object;
}

function mergeObjects(target) {
    for (var i = 1; i < arguments.length; i++) {  // Iterate over arguments starting from index 1
        var source = arguments[i];
        if (source) {  // Check if the source is not null or undefined
            Object.keys(source).forEach(function(key) {
                target[key] = source[key];  // Copy each property to the target
            });
        }
    }
    return target;
}

function constructBasicEventPayload(data) {
    let eventPayload = {};

    const basicData = assemblePayloadComponent(basicDataMappings);
    const customData = assemblePayloadComponent(customDataMappings);
    const userData = assemblePayloadComponent(userDataMappings);
    const lduData = assemblePayloadComponent(lduDataMappings);

    if (!isEmpty(basicData)) {
        eventPayload = mergeObjects(eventPayload, basicData);
    }
    if (!isEmpty(userData)) {
        eventPayload.user_data = userData;
    }
    // Only add custom_data if it has properties
    if (!isEmpty(customData) && Object.keys(customData).length > 0) {
        eventPayload.custom_data = customData;
    }
    // Only add data_processing_options if LDU data exists and has values
    if (!isEmpty(lduData) && lduData.data_processing_options && 
        lduData.data_processing_options.length > 0) {
        eventPayload.data_processing_options = lduData.data_processing_options;
        if (lduData.data_processing_options_country) {
            eventPayload.data_processing_options_country = lduData.data_processing_options_country;
        }
        if (lduData.data_processing_options_state) {
            eventPayload.data_processing_options_state = lduData.data_processing_options_state;
        }
    }

    digestLog('Info', 'Payload building', 'Omni Tag', {
        message: 'Payload building complete: ' + JSON.stringify(eventPayload)
    });
    return eventPayload;
}

function constructAndEnrichPayload(data) {
    return Promise.create((resolve, reject) => {
        let eventPayload = constructBasicEventPayload(data);
        if (isOmniIdentityResolutionEnabled) {
            enrichPayloadUsingOmniIdentity(eventPayload)
                .then(finalPayload => {
                    digestLog('Info', 'Identity enrichment', 'Omni Tag', {
                        message: "Identity enrichment successful"
                    });
                    resolve(finalPayload);  // Resolve with enriched data
                })
                .catch(error => {
                    digestLog('Error', 'Identity enrichment', 'Omni Tag', {
                        message: "Identity enrichment unsuccessful. Resolving the promise with raw event payload due to error: " + error
                    });
                    resolve(eventPayload);  // Resolve with original payload on error
                });
        } else {
            resolve(eventPayload);  // If no enrichment needed, resolve with original payload
        }
    });
}

function enrichPayloadUsingOmniIdentity(eventPayload) {
    return generateOmniIdentityEnrichment(eventPayload)
        .then(response => {
            digestLog('Info', 'Identity resolution', 'Omni Tag', {
                message: 'Identity resolution successful'
            });
            return applyOmniIdentityEnrichment(response, eventPayload);
        })
        .catch(error => {
            digestLog('Error', 'Identity resolution', 'Omni Tag', {
                message: 'Identity resolution unsuccessful: ' + error
            });
            return Promise.reject(error);
        });
}


function generateOmniIdentityEnrichment(eventPayload) {
    const omniIdentityEndpoint = data.omniIdentityEndpoint;
    const omniIdentityAccessToken = data.omniIdentityAccessToken;
    const anonUserIdentifierForIR = data.anonUserIdentifierForIR;
    const omniIdentityLoggingKey = data.omniIdentityLoggingKey;
    const eventName = prepEventName(data.eventName, data.customEventName);

    digestLog('Info', 'Identity resolution', 'Omni Identity', {
        message: 'Started generating Omni Identity enrichment'
    });
    // Build identity payload dynamically using variables
    const staticIdentityProperties = {
        platform: omniIdentityLoggingKey,
        count_prev_visits: true,
        valuation_properties: {
          action: eventName,
          properties: eventData
        }
    };

    logToConsole('identity built staticidentityprops');

    let identityPayload = mergeObjects(omniIdentityObject, staticIdentityProperties);

    logToConsole('identity built after idenetitypayload', identityPayload);


    // Add anonymous ID if provided
    if (anonUserIdentifierForIR) {
        identityPayload.anonymous_id = anonUserIdentifierForIR;
    } else {
        identityPayload.anonymous_id = eventData['x-ga-mp2-data[client_id]'];
    }

    digestLog('Info', 'Identity resolution', 'Omni Identity', {
        message: 'Identity payload: ' + JSON.stringify(identityPayload)
    });

    const requestOptions = {
        method: 'POST',
        headers: {
            'Authorization': 'Bearer ' + omniIdentityAccessToken,
            'Content-Type': 'application/json'
        }
    };

    const requestBody = JSON.stringify(identityPayload);

    // Log request details
    digestLog('Request', 'Identity resolution', 'Omni Identity', {
        requestMethod: requestOptions.method,
        requestUrl: omniIdentityEndpoint,
        requestHeaders: requestOptions.headers,
        requestBody: requestBody
    });

    return sendHttpRequest(omniIdentityEndpoint, requestOptions, requestBody)
        .then(response => {
            // Log response details
            digestLog('Response', 'Identity resolution', 'Omni Identity', {
                statusCode: makeInteger(response.statusCode),
                responseHeaders: response.headers,
                responseBody: JSON.parse(response.body)
            });

            // Handle non-200 responses
            if (response.statusCode < 200 || response.statusCode >= 300) {
                const errorMsg = 'Request failed with status: ' + response.statusCode;
                digestLog('Error', 'Identity resolution', 'Omni Identity', {
                    message: errorMsg
                });
                return Promise.reject(errorMsg);
            }

            return response;
        })
        .catch(error => {
            const errorMsg = 'Error handling API response: ' + error;
            digestLog('Error', 'Identity resolution', 'Omni Identity', {
                message: errorMsg
            });
            return Promise.reject(errorMsg);
        });
}

function applyOmniIdentityEnrichment(response, eventPayload) {
    const responseBody = JSON.parse(response.body);
    const identityData = responseBody.data;

    if (!identityData || !identityData.uuid) {
        const errorMsg = 'UUID not found in response; enrichment failed. Response: ' + JSON.stringify(responseBody);
        digestLog('Error', 'Identity enrichment', 'Omni Tag', {
            message: errorMsg
        });
        return Promise.reject(errorMsg);
    }

    // Initialize user_data if it doesn't exist
    eventPayload.user_data = eventPayload.user_data || {};

    // Apply enrichments based on configuration
    if (data.enrichExtIdwithOmniUnifiedId) {
        eventPayload.user_data.external_id = identityData.uuid;
    }

    if (data.enrichPayloadWithOmniIdentityEmail && identityData.email && !eventPayload.user_data.em) {
        eventPayload.user_data.em = hash(identityData.email);
    }

    return eventPayload;
}

function dispatchPayloadToMetaApi(payload) {
    digestLog('Info', 'Dispatch', 'Meta Conversion API', {
        message: 'Starting Meta API dispatch'
    });

    const fbToken = data.metaApiToken;
    const fbPixel = data.metaPixelID;

    if (!fbToken || !fbPixel) {
        const errorMsg = 'Missing Facebook API token or Pixel ID';
        digestLog('Error', 'Dispatch', 'Omni Tag', {
            message: errorMsg
        });
        return Promise.reject(errorMsg);
    }

    const fbUrl = 'https://graph.facebook.com/v19.0/' + fbPixel + '/events?access_token=' + fbToken;
   
    const requestHeaders = {
        'Content-Type': 'application/json'
    };

    const requestOptions = {
        method: 'POST',
        headers: requestHeaders,
        timeout: 5000
    };

    const payloadString = JSON.stringify(payload);
    
    digestLog('Info', 'Dispatch', 'Meta Conversion API', {
        message: 'Preparing to send request to Meta API',
        url: fbUrl,
        payload: payload
    });

    return Promise.create((resolve, reject) => {
        sendHttpRequest(fbUrl, requestOptions, payloadString)
            .then(response => {
                digestLog('Info', 'Dispatch', 'Meta Conversion API', {
                    message: 'Received response from Meta API'
                });
                
                if (response.statusCode < 200 || response.statusCode >= 300) {
                    const responseBody = JSON.parse(response.body || '{}');
                    const errorMsg = 'Request failed with status: ' + response.statusCode + 
                        '. Response: ' + JSON.stringify(responseBody);
                    
                    digestLog('Error', 'Dispatch', 'Meta Conversion API', {
                        message: errorMsg,
                        statusCode: response.statusCode,
                        responseBody: responseBody
                    });
                    reject(errorMsg);
                } else {
                    digestLog('Info', 'Dispatch', 'Meta Conversion API', {
                        message: 'Request successful'
                    });
                    resolve(response);
                }
            })
            .catch(error => {
                const errorMsg = 'Error during API call: ' + error;
                digestLog('Error', 'Dispatch', 'Meta Conversion API', {
                    message: errorMsg
                });
                reject(errorMsg);
            });
    });
}

function validateUserData(userData) {
    digestLog('Info', 'Validation', 'Meta Conversion API', {
        message: 'Starting user data validation'
    });

    const fieldsToValidate = ['fn', 'ln', 'ge', 'ct', 'em', 'ph'];
    const invalidFields = [];
    
    fieldsToValidate.forEach(field => {
        if (userData[field]) {
            digestLog('Info', 'Validation', 'Meta Conversion API', {
                message: 'Validating field: ' + field + ' with value: ' + userData[field]
            });
            
            if (!isValidHash(userData[field])) {
                invalidFields.push(field);
                digestLog('Error', 'Validation', 'Meta Conversion API', {
                    message: 'Invalid hash for field: ' + field
                });
            }
        }
    });
    
    if (invalidFields.length > 0) {
        const errorMsg = 'Invalid hashes for fields: ' + invalidFields.join(', ');
        digestLog('Error', 'Validation', 'Meta Conversion API', {
            message: errorMsg
        });
        return false;
    }
    
    digestLog('Info', 'Validation', 'Meta Conversion API', {
        message: 'User data validation successful'
    });
    
    return true;
}

function isValidPayload(payload) {
    digestLog('Info', 'Validation', 'Meta Conversion API', {
        message: 'Starting payload validation'
    });

    // Basic payload check
    if (!payload) {
        const msg = 'Payload is null or undefined';
        digestLog('Error', 'Validation', 'Meta Conversion API', {
            message: msg
        });
        return false;
    }

    // User data check
    if (!payload.user_data) {
        const msg = 'Missing user_data in payload';
        digestLog('Error', 'Validation', 'Meta Conversion API', {
            message: msg
        });
        return false;
    }
    
    // Hash validation
    if (!validateUserData(payload.user_data)) {
        return false; // validateUserData handles its own logging
    }
    
    // Required fields validation
    if (!payload.event_name) {
        const msg = 'Missing event_name in payload';
        digestLog('Error', 'Validation', 'Meta Conversion API', {
            message: msg
        });
        return false;
    }

    if (!payload.event_time) {
        const msg = 'Missing event_time in payload';
        digestLog('Error', 'Validation', 'Meta Conversion API', {
            message: msg
        });
        return false;
    }

    if (!payload.action_source) {
        const msg = 'Missing action_source in payload';
        digestLog('Error', 'Validation', 'Meta Conversion API', {
            message: msg
        });
        return false;
    }

    // Website specific validation
    if (payload.action_source === 'website') {
        if (!payload.user_data.client_user_agent) {
            const msg = 'Missing client_user_agent for website action_source';
            digestLog('Error', 'Validation', 'Meta Conversion API', {
                message: msg
            });
            return false;
        }
        if (!payload.user_data.client_ip_address) {
            const msg = 'Missing client_ip_address for website action_source';
            digestLog('Error', 'Validation', 'Meta Conversion API', {
                message: msg
            });
            return false;
        }
        if (!payload.event_source_url) {
            const msg = 'Missing event_source_url for website action_source';
            digestLog('Error', 'Validation', 'Meta Conversion API', {
                message: msg
            });
            return false;
        }
    }

    // LDU validation
    if (payload.data_processing_options === 'LDU') {
        if (!payload.data_processing_options_country) {
            const msg = 'Missing data_processing_options_country for LDU';
            digestLog('Error', 'Validation', 'Meta Conversion API', {
                message: msg
            });
            return false;
        }
        if (!payload.data_processing_options_state) {
            const msg = 'Missing data_processing_options_state for LDU';
            digestLog('Error', 'Validation', 'Meta Conversion API', {
                message: msg
            });
            return false;
        }
    }
    
    // Log the full payload for debugging
    digestLog('Info', 'Validation', 'Meta Conversion API', {
        message: 'Current payload state: ' + JSON.stringify(payload)
    });
    
    digestLog('Info', 'Validation', 'Meta Conversion API', {
        message: 'Payload validation successful'
    });
    
    return true;
}

function formatPayloadForDispatch(payload) {
    digestLog('Info', 'Formatting', 'Omni Tag', {
        message: 'Starting payload formatting'
    });

    if (!payload) {
        const errorMsg = 'Payload for validation empty';
        digestLog('Error', 'Formatting', 'Omni Tag', {
            message: errorMsg
        });
        return Promise.reject(errorMsg);
    }

    let payloadForDispatch = {
        data: [payload],
    };
    
    if (data.enableDatomniAsPartnerAgent) {
        payloadForDispatch.partner_agent = 'datomni';
    }
    
    if (data.thisIsTestEvent === true) {
        payloadForDispatch.test_event_code = data.testEventCode;
    }

    digestLog('Info', 'Formatting', 'Omni Tag', {
        message: 'Payload formatting complete'
    });

    return payloadForDispatch;
}

function isValidHash(hash) {
    digestLog('Info', 'Validation', 'Meta Conversion API', {
        message: 'Checking hash validity for: ' + hash
    });

    if (!hash || typeof hash !== 'string') {
        digestLog('Error', 'Validation', 'Meta Conversion API', {
            message: 'Hash is null or not a string'
        });
        return false;
    }
    
    // Hex character set
    const regexPattern = '[^a-f0-9]';  // hex digits only
    const hexRegex = createRegex(regexPattern, 'gi');
    
    // Check if there are any non-hex characters
    const hasInvalidChars = hash.match(hexRegex);
    
    // SHA256 in hex is exactly 64 characters
    const isValid = !hasInvalidChars && hash.length === 64;

    digestLog('Info', 'Validation', 'Meta Conversion API', {
        message: 'Hash validation result: ' + isValid + ' for hash: ' + hash
    });

    return isValid;
}

function runOmniMetaApiTag(data) {
    digestLog('Info', 'Operation', 'Omni Tag', {
        message: 'Starting tag execution'
    });

    constructAndEnrichPayload(data)
        .then(eventPayload => {
            digestLog('Info', 'Operation', 'Omni Tag', {
                message: 'Payload constructed, starting validation. Payload: ' + JSON.stringify(eventPayload)
            });

            if (!eventPayload) {
                const msg = 'Event payload is null or undefined';
                digestLog('Error', 'Operation', 'Omni Tag', {
                    message: msg
                });
                return Promise.reject(msg);
            }

            if (!isValidPayload(eventPayload)) {
                const msg = 'Validation failed for the event payload';
                digestLog('Error', 'Validation', 'Meta Conversion API', {
                    message: msg
                });
                return Promise.reject(msg);
            }

            digestLog('Info', 'Operation', 'Omni Tag', {
                message: 'Validation passed, formatting payload for dispatch'
            });

            return formatPayloadForDispatch(eventPayload);
        })
        .then(payloadForDispatch => {
            if (!payloadForDispatch) {
                const msg = 'Formatted payload is null or undefined';
                digestLog('Error', 'Operation', 'Omni Tag', {
                    message: msg
                });
                return Promise.reject(msg);
            }

            digestLog('Info', 'Operation', 'Omni Tag', {
                message: 'Payload formatted, starting dispatch to Meta API'
            });

            return dispatchPayloadToMetaApi(payloadForDispatch);
        })
        .then(response => {
            const executionTime = getTimestampMillis() - tagInitializationTime;
            digestLog('Info', 'Operation', 'Omni Tag', {
                message: 'Tag execution completed successfully with execution time: ' + executionTime + 'ms | Initialization time: ' + tagInitializationTime + 'ms | Completion time: ' + getTimestampMillis() + 'ms',
            });
            data.gtmOnSuccess();
        })
        .catch(error => {
            const executionTime = getTimestampMillis() - tagInitializationTime;
            const errorMsg = 'Operational error: ' + (error && error.toString ? error.toString() : 'Unknown error');
            
            digestLog('Error', 'Operation', 'Omni Tag', {
                message: 'Error stack trace start'
            });
            
            digestLog('Tag error', 'Operation', 'Omni Tag', {
                message: errorMsg + ' | Execution time: ' + executionTime + 'ms | Initialization time: ' + tagInitializationTime + 'ms | Failure time: ' + getTimestampMillis() + 'ms',
            });
            
            digestLog('Error', 'Operation', 'Omni Tag', {
                message: 'Error stack trace end'
            });
            
            data.gtmOnFailure();
        });
}

runOmniMetaApiTag(data);


___SERVER_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_container_data",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_event_data",
        "versionId": "1"
      },
      "param": [
        {
          "key": "eventDataAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_http",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 1/21/2025, 1:57:26 PM


